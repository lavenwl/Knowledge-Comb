### zk选举(蚂蚁金服)

1. zookeeper是雅虎基于google的非开源产品chubby开发的开源版本, 但chubby是使用的paox协议, 但zookeeper则使用了zookeeper专用的zab协议.

2. zookeeper的开发初衷是分布式锁的控制框架, 但基于这个特性, 在分布式开发当中还可以当做注册中心与配置中心使用

3. zookeeper的主要算法是leader选举与....

4. leader选举的过程是:

    1. 当服务启动时, 各节点会向其他节点发送一个包含有myid, zxid, epoch 信息的票据.
    2. 当其他节点接收到此票据后, 会验证票据的有效性, 如对应的票据是否发送至looking状态的节点, 且epoch是否属于本轮投票.
    3. 按照epoch, zxid, myid的优先级比较, 谁大, 则选举谁为leader.
    4. 在比较结束后, 会对每轮的投票结果进行记录, 并根据是否过半判断是否具备leader.
    5. 如果没有leader, 则继续进行下一轮选举, 如果有leader, 这更新服务状态, leader还是following.

    > 另外, 当leader挂掉后, 其他节点在没有接收到leader的心跳包会自动进入选举流程